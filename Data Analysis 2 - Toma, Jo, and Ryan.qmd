---
title: "Data Analysis 2"
authors: 
  Maksuda Aktar Toma,
  Jo Charbonneau,
  Ryan Lalicker
date: today
date-format: long
abstract: |
  If we want an abstract it will go here.  References are in the form @placeHolder or [@placeHolder].  For more information see [here](https://www.youtube.com/watch?v=dQw4w9WgXcQ).
execute: 
  echo: false
  warning: false
columns: 2
format:
  pdf: 
    extensions-dir: quarto-wordcount/_extensions/wordcount
    fig-align: center
    fig-width: 6
    fig-height: 4
bibliography: references.bib
editor: 
  markdown: 
    wrap: sentence
---

```{r}
#| label: data-setup
#| echo: false
#| eval: true
data <- read.csv("data.csv")
```

```{r}
#| label: Scratch work
#| echo: false
#| eval: false

num_unique_tissu <- length(unique(data$tissu))
num_unique_tissu
num_unique_time <- length(unique(data$time))
num_unique_time
time_counts <- table(data$time)
time_counts
num_unique_dp <- length(unique(data$dayPeriod))
num_unique_dp
table(data$campagne)
num_unique_camp <- length(unique(data$campagne))
```

# Introduction

Our clients conducted an experiment to determine the effect pine tissues, precipitation levels, time, and the interaction of these variables effects starch content. In total, 408 entries were recorded.  The experiment was replicated at two locations as well and not all measurements within each replication were taken from the same sample location. (dont like that last line)

We intend to analysis the results of this data below.  We will review the variables, fit multiple models, and make a suggestion to the client.  The data set, `data.csv`, and all other files used in this project can be found on our  [Github page](https://github.com/RyanLalicker/Data-Analysis-2-STAT-325-825).


# Exploring the Data

## Variables

In the data set provided by the client there are four tissue types which are abbreviated as END, IT, LM, and UM.  This can be found in the `tissu` column.  The two precipitation levels, control and drought, are in the `treatment` column.  The time component of the experiment is not simply one variable.  The `time` column consists of six different times, with six being denoted by the first six letters of the alphabet. In addition to `time`, the column `dayPeriod` indicates whether the measurement was taken in the day or at night. Time points C and D appear to correspond to a `dayPeriod` of night, while all other time points are during the day. Note, the measurements for the starch contents can be found in the `StarchNscTissue` and each sample number can be found in the `sample` column.

The data set provided by the client also includes variables that indicate the physical location of where the measurement was taken within a sample.  These are represented the columns `row`, `col`, and `chamber` with the latter being in the form `row`-`col` for each respective entry. The possible values of `row` and `col` range from one to four. Also, since the experiment was carried out at two locations which is represented by the `campagne` column.  


### Changes made to the variables in the original data set

Note there were a couple of problems with the original data set.  Initially the `time` column included a seventh time, A'.  Since this did not follow the format of the other time points and had substantially fewer occurrences in the data, we assumed this was a mistake.  Therefore, we manually changed all occurrences of A' to A.

The other potential issue was in the `chamber` column.  As stated above this column should be a combination of `row` and `col`, but the original data set was treating it as a date.  For example if one sample has the values `row` $=1$ and `col` $=4$, the result of `chamber` should be $1-4$.  Instead the original data set was showing January 4th.  We chose to manually change this to the correct format as well.


## Summary Statistics

While some of the variables outlined above are numeric, most can be treated as categorical.  The lone exception to this is the starch content.  The table below shows some summary statistics for the starch content.  This includes not only the summaries of all 408 measurements, but also the summaries based on the two values of `campagne` and `dayPeriod`.


```{r}
#| label: fig-abbrevstats
#| echo: false
#| eval: true

library(knitr)
library(dplyr)

overall_summary <- data %>%
  summarize(
    Mean = mean(StarchNscTissue, na.rm = TRUE),
    Median = median(StarchNscTissue, na.rm = TRUE),
    SD = sd(StarchNscTissue, na.rm = TRUE),
    Min = min(StarchNscTissue, na.rm = TRUE),
    Max = max(StarchNscTissue, na.rm = TRUE),
    N = n()
  ) %>%
  mutate(Group = "Overall")

# By Location (campagne)
location_summary <- data %>%
  group_by(campagne) %>%
  summarize(
    Mean = mean(StarchNscTissue, na.rm = TRUE),
    Median = median(StarchNscTissue, na.rm = TRUE),
    SD = sd(StarchNscTissue, na.rm = TRUE),
    Min = min(StarchNscTissue, na.rm = TRUE),
    Max = max(StarchNscTissue, na.rm = TRUE),
    N = n()
  ) %>%
  mutate(Group = paste("campagne:", campagne))

# By DayPeriod
dayperiod_summary <- data %>%
  group_by(dayPeriod) %>%
  summarize(
    Mean = mean(StarchNscTissue, na.rm = TRUE),
    Median = median(StarchNscTissue, na.rm = TRUE),
    SD = sd(StarchNscTissue, na.rm = TRUE),
    Min = min(StarchNscTissue, na.rm = TRUE),
    Max = max(StarchNscTissue, na.rm = TRUE),
    N = n()
  ) %>%
  mutate(Group = paste("dayPeriod:", dayPeriod))

# Combine tables
combined_summary <- bind_rows(overall_summary, location_summary, dayperiod_summary) %>%
  arrange(factor(Group, levels = c("Overall", unique(location_summary$Group), unique(dayperiod_summary$Group)))) %>%
  select(Group, N, Mean, Median, SD, Min, Max)

# Display the table
kable(combined_summary, format = "markdown", caption = "Summary statistics of starch content.")
```

For starch contents across all measurements, the values range from about 0.019 to 7.898 with a median of roughly 1.430 and a mean of 1.925.  The location of the median and mean with respect to the minimum and maximum is an early sign that the starch contents could be skewed and thus non-normal in distribution.

When comparing the two locations (`campagne`) where the experiment was replicated, we can see the 184 measurements from the first location seems to have lower values on average than the 224 measurements from location 2.  There is a smaller difference in these metrics when comparing measurements taken in the day versus those taken in the night. Note over twice as many measurements were taken in the day.  

To generate a table of summary statistics that account for more of the variables see *Appendix A - R Code*.  That table is not included here due to its larger size. 

As previously noted, the table above indicates the starch contents may be skewed and thus non-normal.  This can be evaluated through a histogram and Q-Q plot.  The histogram below supports our suspicion that the data is skewed and the Q-Q plot confirms the measure is non-normal.  Note, all 408 measurements of starch content are used in the plots.

```{r}
#| label: fig-normallity
#| echo: false
#| eval: true
#| layout-ncol: 2
#| fig-cap: "Plots used to check normallity assumption."
#| fig-subcap: 
#|  - "Histogram of starch content."
#|  - "Q-Q plot of starch content."
library(ggplot2)

ggplot(data, aes(x = StarchNscTissue)) +
  geom_histogram(binwidth = 0.5, color = "black", fill = "skyblue") +
  labs(
    x = "StarchNscTissue",
    y = "Frequency"
  ) +
  theme_minimal()

ggplot(data, aes(sample = StarchNscTissue)) +
  stat_qq() +
  stat_qq_line(color = "red") +
  labs(
    x = "Theoretical Quantiles",
    y = "Sample Quantiles"
  ) +
  theme_minimal()

```


## Relationships among variables




# Potential models

The replication mentioned above suggests a mixed model approach is needed.  This is due to the replication being a random effect.  The simplest case of a this type of model is a linear mixed model.  To use this, the residuals of the model must be approximately normally distributed.






## How explanatory variables can be used

(talk about nesting vs non-nesting methods I guess.  Just introduce the idea before we actually make the models.)

# Summary Statistics


**Summary_Statistic**




```{r}
#| label: fig-2-sumstats
#| echo: false
#| fig-cap: "jjj "

data <- read.csv("data.csv")
# Load necessary libraries
library(dplyr)
library(ggplot2)

# Summary statistics for StarchNscTissue by tissue type, treatment, dayPeriod, and time
summary_data <- data %>%
  group_by(tissu, treatment, dayPeriod, time) %>%
  summarize(
    mean_Starch = mean(StarchNscTissue, na.rm = TRUE),
    sd_Starch = sd(StarchNscTissue, na.rm = TRUE),
    median_Starch = median(StarchNscTissue, na.rm = TRUE),
    min_Starch = min(StarchNscTissue, na.rm = TRUE),
    max_Starch = max(StarchNscTissue, na.rm = TRUE),
    n = n()
  )

print(summary_data)

## 1. Line Plot of Mean Starch Content by Time
##This plot shows the trend of mean starch content across time segments for each tissue type and treatment.

ggplot(summary_data, aes(x = time, y = mean_Starch, color = treatment, group = treatment)) +
  geom_line() +
  geom_point() +
  facet_grid(tissu ~ dayPeriod) +
  labs(
    title = "Mean Starch Content by Time, Treatment, and Tissue Type",
    x = "Time Segment",
    y = "Mean Starch Content"
  ) +
  theme_minimal()
##2. Bar Plot of Mean Starch Content by Tissue Type and Treatment
#This bar plot can help compare the mean starch content between treatments for each tissue type, averaged over all time points.

ggplot(summary_data, aes(x = tissu, y = mean_Starch, fill = treatment)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ dayPeriod) +
  labs(
    title = "Mean Starch Content by Tissue Type and Treatment",
    x = "Tissue Type",
    y = "Mean Starch Content"
  ) +
  theme_minimal()

##3. Error Bar Plot with Mean and Standard Deviation
#An error bar plot provides a visual of mean starch content with variability (standard deviation) across time, separated by tissue and treatment.

ggplot(summary_data, aes(x = time, y = mean_Starch, color = treatment, group = treatment)) +
  geom_line() +
  geom_point() +
  geom_errorbar(aes(ymin = mean_Starch - sd_Starch, ymax = mean_Starch + sd_Starch), width = 0.2) +
  facet_grid(tissu ~ dayPeriod) +
  labs(
    title = "Mean Starch Content with Standard Deviation by Time and Treatment",
    x = "Time Segment",
    y = "Mean Starch Content"
  ) +
  theme_minimal()

##Box_Plot
ggplot(data, aes(x = tissu, y = StarchNscTissue, fill = treatment)) +
  geom_boxplot() +
  facet_wrap(~ dayPeriod) +
  labs(
    title = "Boxplot of Starch Content by Tissue Type and Treatment",
    x = "Tissue Type",
    y = "Starch Content"
  ) +
  theme_minimal()

##Box_Plot with Interaction
ggplot(data, aes(x = time, y = StarchNscTissue, color = treatment, group = treatment)) +
  geom_line(stat = "summary", fun = mean) +
  geom_point(stat = "summary", fun = mean) +
  facet_wrap(~ dayPeriod) +
  labs(
    title = "Interaction Plot: Starch Content by Time and Treatment within DayPeriod",
    x = "Time Segment",
    y = "Mean Starch Content"
  ) +
  theme_minimal()

```

# Model : Mixed Effects Model with Interactions In this model, we include interactions between tissu, treatment, and dayPeriod to evaluate their combined effects on StarchNscTissue.

```{r}
#| label: fig-3
#| echo: false
#| fig-cap: " "

# Load necessary libraries
library(lme4)
library(lmerTest)  # for p-values

# Mixed Effects Model with Interactions
model <- lmer(StarchNscTissue ~ tissu * treatment * dayPeriod + 
               (1 | campagne) + (1 | sample) + (1 | chamber), data = data)

# Summary of the model
summary(model)

# Check model fit using AIC and BIC
AIC(model)
BIC(model)

# Test significance of interaction terms
anova(model)


```

## Checking assumption

```{r}
# Q-Q plot for residuals
qqnorm(residuals(model))
qqline(residuals(model))
shapiro.test(residuals(model))
# Residuals vs. Fitted plot for homogeneity of variance
plot(fitted(model), residuals(model))
abline(h = 0, col = "red")
# Autocorrelation of residuals
library(ggplot2)
acf(resid(model), main = "Autocorrelation of Residuals")




```

## Model 3: Nested Model for DayPeriod and Time Effects In this model, dayPeriod is used as a broader time effect, with time nested within dayPeriod.
This model also includes campagne, sample, and chamber as random effects.

```{r}
#| label: fig-4
#| echo: false
#| fig-cap: " "

# Mixed Effects Model with Nested Time within DayPeriod
model3 <- lmer(StarchNscTissue ~ tissu + treatment + dayPeriod + dayPeriod:time + 
               (1 | campagne) + (1 | sample) + (1 | chamber), data = data)

# Summary of the model
summary(model3)

# Check model fit using AIC and BIC
AIC(model3)
BIC(model3)

# Test significance of nested terms
anova(model3)

```

```{r}
#| label: fig-5
#| echo: false
#| fig-cap: " "
# Q-Q plot for residuals
qqnorm(residuals(model3))
qqline(residuals(model3))
shapiro.test(residuals(model3))
# Residuals vs. Fitted plot for homogeneity of variance
plot(fitted(model3), residuals(model3))
abline(h = 0, col = "red")

# Autocorrelation of residuals
library(ggplot2)
acf(resid(model3), main = "Autocorrelation of Residuals")
```

```{r}
#| label: fig-6
#| echo: false
#| fig-cap: " "

# Model 2 - Interaction effects
model_2 <- lm(StarchNscTissue ~ treatment * tissu * dayPeriod + campagne, data = data)
summary(model_2)

```

```{r}
# Q-Q plot for residuals
qqnorm(residuals(model_2))
qqline(residuals(model_2))
shapiro.test(residuals(model_2))
# Residuals vs. Fitted plot for homogeneity of variance
plot(fitted(model_2), residuals(model_2))
abline(h = 0, col = "red")

```

```{r}
#| label: fig-7
#| echo: false
#| fig-cap: " "

# Model 3 - Mixed model with chamber as random effect
model_3 <- lmer(StarchNscTissue ~ treatment * tissu * dayPeriod + campagne + (1 | chamber), data = data)
summary(model_3)

```

```{r}
# Q-Q plot for residuals
qqnorm(residuals(model_3))
qqline(residuals(model_3))
shapiro.test(residuals(model_3))
# Residuals vs. Fitted plot for homogeneity of variance
plot(fitted(model_3), residuals(model_3))
abline(h = 0, col = "red")

```

# Conclusion



GitHub page found [here](https://github.com/RyanLalicker/Data-Analysis-2-STAT-325-825).



\newpage

# References

::: {#refs}
:::

\newpage

# Appendix A - R Code

```{r}
#| label: appendix A
#| echo: true
#| eval: false

## Prints code without running it

library(knitr)
data <- read.csv("data.csv")
knitr::kable(head(data), format = 'markdown')






```


\newpage

# Appendix B - SAS Code


``` sas

data rptm_means;
input Inoculation_Method $ Thickness $ @@; 
do Week=1 to 5 by 1; 
    input mu @@; 
    output; 
end;
datalines;
Dry 1/4 4.2573 4.246 4.474 4.3327 4.0127
Dry 1/8 5.2907 4.9513 5.2013 5.2073 4.9713
Wet 1/4 5.4013 5.5727 5.55 5.4873 5.3807
Wet 1/8 5.56 5.7793 5.6313 5.7153 5.62
;
```
